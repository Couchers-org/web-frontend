# Web Frontend

This helm chart is just using a subchart of our standardized deployment helm charts

## Introduction

This chart bootstraps a highly available deployment on a [Kubernetes](http://kubernetes.io) cluster using the [Helm](https://helm.sh) package manager.

## Prerequisites

- Kubernetes 1.10+ with Beta APIs enabled
- The kubectl binary
- The helm binary
- Helm diff plugin installed

## Installing the Chart

To install the chart...

```bash
# For dev (dynamic dev envs, namespace autogenerated from branch name, deployed (and created dynamically) automatically on every branch)
export SERVICE_NAME="web-frontend"
export CI_ENVIRONMENT_SLUG="dev"
export K8S_NAMESPACE="web-frontend-web-tweak-become-host-link"  # Dynamic namespace for dev, replace if needed (eg: web-frontend-BRANCHNAME_SLUGGED)
export HELM_CHART=$SERVICE_NAME
export CURRENT_HELM_CHART=$SERVICE_NAME
export HELM_IMG_TAG="development-e74b591f98c47fb4a1ba784e560b3de993ebdc7f"  # development-* images built on branches (aka non-master)

# For staging (static namespace/env, staging namespace, deployed to automatically from master branch)
export SERVICE_NAME="web-frontend"
export CI_ENVIRONMENT_SLUG="staging"
export K8S_NAMESPACE="staging"  # Dynamic namespace for dev, replace if needed (eg: web-frontend-BRANCHNAME_SLUGGED)
export HELM_CHART=$SERVICE_NAME
export CURRENT_HELM_CHART=$SERVICE_NAME
export HELM_IMG_TAG="staging-ff94eb6e2aaa55a36f52d4995950d429381662b7"      # staging-* images built on master branch

# For preproduction (static namespace/env, preprod namespace, deployed to manually via Github Actions upon request (todo)
export SERVICE_NAME="web-frontend"
export CI_ENVIRONMENT_SLUG="preprod"
export K8S_NAMESPACE="preprod"  # Dynamic namespace for dev, replace if needed (eg: web-frontend-BRANCHNAME_SLUGGED)
export HELM_CHART=$SERVICE_NAME
export CURRENT_HELM_CHART=$SERVICE_NAME
export HELM_IMG_TAG="production-32895dd012e86909b6c4879bbb0579723f8d91ab"   # production-* images built on git tags (Aka Github Releases)

# For production (static namespace/env, prod namespace, deployed to automatically from Github Deployments / Tags (ideally semver (1.x.x))
export SERVICE_NAME="web-frontend"
export CI_ENVIRONMENT_SLUG="prod"
export K8S_NAMESPACE="preprod"  # Dynamic namespace for dev, replace if needed (eg: web-frontend-BRANCHNAME_SLUGGED)
export HELM_CHART=$SERVICE_NAME
export CURRENT_HELM_CHART=$SERVICE_NAME
export HELM_IMG_TAG="production-32895dd012e86909b6c4879bbb0579723f8d91ab"   # production-* images built on git tags (Aka Github Releases)


# Go into our deployment folder
cd deployment
# Update our helm subchart...
helm dependencies update $SERVICE_NAME/
# FOR TESTING/DEBUGGING ONLY OR DOING MANUAL KUBECTL APPLIES...
helm template --namespace $K8S_NAMESPACE $CURRENT_HELM_CHART $HELM_CHART -f $CURRENT_HELM_CHART/values.yaml     -f $CURRENT_HELM_CHART/values-${CI_ENVIRONMENT_SLUG}.yaml --set global.namespace="$K8S_NAMESPACE"  --set global.image.tag="$HELM_IMG_TAG"
# View the diff of what you want to do
helm diff upgrade --namespace $K8S_NAMESPACE --allow-unreleased $CURRENT_HELM_CHART $HELM_CHART     -f $CURRENT_HELM_CHART/values.yaml     -f $CURRENT_HELM_CHART/values-${CI_ENVIRONMENT_SLUG}.yaml --set global.namespace="$K8S_NAMESPACE"  --set global.image.tag="$HELM_IMG_TAG"
# Actually do it...
helm upgrade --namespace $K8S_NAMESPACE --install $CURRENT_HELM_CHART $HELM_CHART     -f $CURRENT_HELM_CHART/values.yaml     -f $CURRENT_HELM_CHART/values-${CI_ENVIRONMENT_SLUG}.yaml  --set global.namespace="$K8S_NAMESPACE"  --set global.image.tag="$HELM_IMG_TAG"
```

## Configuration

For configuration options possible, please see the open source [Universal Helm Chart - deployment](https://github.com/DevOps-Nirvana/Universal-Kubernetes-Helm-Charts/tree/master/charts/deployment).
